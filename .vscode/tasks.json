{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start Rails Debug Server",
      "type": "shell",
      "command": "docker",
      "args": [
        "container", "exec", "-it", "sjaa-memberships-app-1",
        "bundle", "exec", "rdbg", "--open", "--host", "0.0.0.0", "--port", "1234", "--nonstop",
        "--", "bin/rails", "server", "-b", "0.0.0.0"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Connect to Debug Server",
      "type": "shell", 
      "command": "docker",
      "args": [
        "container", "exec", "-it", "sjaa-memberships-app-1",
        "bundle", "exec", "rdbg", "--attach", "127.0.0.1:1234"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always", 
        "focus": true,
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Run Rails Tests",
      "type": "shell",
      "command": "docker",
      "args": [
        "compose", "run", "--rm", "app",
        "bundle", "exec", "rails", "test", "--verbose"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "new",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": {
        "owner": "ruby",
        "fileLocation": ["relative", "/rails"],
        "pattern": {
          "regexp": "^(.*):(\\d+):in `.*': (.*)$",
          "file": 1,
          "line": 2,
          "message": 3
        }
      }
    },
    {
      "label": "Run Single Test File",
      "type": "shell",
      "command": "docker",
      "args": [
        "compose", "run", "--rm", "app",
        "bundle", "exec", "rails", "test", "${relativeFile}", "--verbose"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "new"
      },
      "problemMatcher": {
        "owner": "ruby",
        "fileLocation": ["relative", "/rails"],
        "pattern": {
          "regexp": "^(.*):(\\d+):in `.*': (.*)$",
          "file": 1,
          "line": 2,
          "message": 3
        }
      }
    },
    {
      "label": "Run System Tests",
      "type": "shell",
      "command": "docker",
      "args": [
        "container", "exec", "sjaa-memberships-app-1",
        "bin/rails", "test", "test/system/", "--verbose"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "new",
        "showReuseMessage": true,
        "clear": true
      },
      "problemMatcher": {
        "owner": "ruby",
        "fileLocation": ["relative", "/rails"],
        "pattern": [
          {
            "regexp": "^(.*):(\\d+):in `.*': (.*)$",
            "file": 1,
            "line": 2,
            "message": 3
          },
          {
            "regexp": "^Failure:\\s*(.*)\\[(.*?):(\\d+)\\]:$",
            "file": 2,
            "line": 3,
            "message": 1
          }
        ]
      }
    },
    {
      "label": "Run Single System Test",
      "type": "shell",
      "command": "docker",
      "args": [
        "container", "exec", "sjaa-memberships-app-1",
        "bin/rails", "test", "${relativeFile}", "--verbose"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "new",
        "clear": true
      },
      "problemMatcher": {
        "owner": "ruby",
        "fileLocation": ["relative", "/rails"],
        "pattern": [
          {
            "regexp": "^(.*):(\\d+):in `.*': (.*)$",
            "file": 1,
            "line": 2,
            "message": 3
          },
          {
            "regexp": "^Failure:\\s*(.*)\\[(.*?):(\\d+)\\]:$",
            "file": 2,
            "line": 3,
            "message": 1
          }
        ]
      }
    },
    {
      "label": "Rails Console",
      "type": "shell",
      "command": "docker",
      "args": [
        "compose", "run", "--rm", "app",
        "env", "RUBYOPT=-W0",
        "bin/rails", "console"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "new"
      },
      "problemMatcher": []
    }
  ]
}