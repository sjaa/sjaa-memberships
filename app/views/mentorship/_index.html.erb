<%= turbo_frame_tag 'mentors' do %>
  <div data-controller="mentor-contact">
    <% if @mentors.any? %>
      <div class="row mb-3">
        <div class="col-12">
          <h5 class="text-muted">Found <%= @mentors.count %> mentor<%= @mentors.count == 1 ? '' : 's' %></h5>
        </div>
      </div>
      <div class="row g-4">
        <% @mentors.each do |mentor| %>
          <div class="col-12">
            <div class="card shadow-sm">
              <div class="card-body">
                <!-- Title Section - Always at top -->
                <div class="d-flex flex-wrap align-items-center justify-content-between mb-3 pb-3 border-bottom">
                  <h4 class="mb-2 mb-sm-0">
                    <%= "#{mentor.first_name} #{mentor.last_name}" %>
                  </h4>
                  <button type="button"
                        class="btn btn-primary btn-sm"
                        data-mentor-id="<%= mentor.id %>"
                        data-mentor-name="<%= mentor.first_name %> <%= mentor.last_name %>"
                        data-contact-url="<%= mentor_contact_path(mentor) %>"
                        data-action="mentor-contact#openModal">
                    <i class="bi bi-envelope me-1"></i>Contact Mentor
                  </button>
                </div>

                <!-- Profile Picture - Floated Left on md+ -->
                <% if mentor.profile_picture.attached? %>
                  <div class="rounded img-thumbnail float-md-start me-md-4 mb-3 mentor-profile-picture" style="aspect-ratio: 1; background-color: #f8f9fa; background-image: url('<%= url_for(mentor.profile_picture.variant(:display)) %>'); background-size: cover; background-position: center;">
                  </div>
                <% else %>
                  <div class="rounded bg-secondary text-white d-flex align-items-center justify-content-center float-md-start me-md-4 mb-3 mentor-profile-picture" style="aspect-ratio: 1;">
                    <i class="bi bi-person-circle" style="font-size: 6rem;"></i>
                  </div>
                <% end %>

                <!-- Mentor Description -->
                <% if mentor.mentor_description.present? %>
                  <% word_limit = 55 %>
                  <% words = mentor.mentor_description.split %>
                  <% truncated = words.length > word_limit %>
                  <% short_text = truncated ? words.first(word_limit).join(' ') : mentor.mentor_description %>
                  <div class="mb-3">
                    <strong class="text-muted">Why I want to mentor:</strong>
                    <div class="mt-1">
                      <div class="mentor-description-short-<%= mentor.id %>">
                        <%= simple_format(short_text) %>
                        <% if truncated %>
                          <a href="#" class="" onclick="event.preventDefault(); document.querySelector('.mentor-description-short-<%= mentor.id %>').style.display='none'; document.querySelector('.mentor-description-full-<%= mentor.id %>').style.display='block';">more...</a>
                        <% end %>
                      </div>
                      <% if truncated %>
                        <div class="mentor-description-full-<%= mentor.id %>" style="display: none;">
                          <%= simple_format(mentor.mentor_description) %>
                          <a href="#" class="" onclick="event.preventDefault(); document.querySelector('.mentor-description-short-<%= mentor.id %>').style.display='block'; document.querySelector('.mentor-description-full-<%= mentor.id %>').style.display='none';">less...</a>
                        </div>
                      <% end %>
                    </div>
                  </div>
                <% end %>

                <!-- Interests -->
                <% if mentor.interests.any? %>
                  <div class="mb-3">
                    <strong class="text-muted small">Interests:</strong>
                    <div class="mt-1">
                      <% mentor.interests.each do |interest| %>
                        <span class="badge bg-light text-dark me-1"><%= interest.name.titleize %></span>
                      <% end %>
                    </div>
                  </div>
                <% end %>

                <!-- Skills -->
                <% active_skills = mentor.people_skills.select(&:active?).sort_by { |ps| -ps.skill_level.to_i } %>
                <% if active_skills.any? %>
                  <div class="mb-2 row">
                    <h4 class="text-muted">Skills</h4>
                  </div>
                  <div class="row g-3">
                    <% active_skills.each do |people_skill| %>
                      <div class="col-sm-6 col-lg-4">
                        <%= render partial: 'shared/skill_card', locals: { people_skill: people_skill } %>
                      </div>
                    <% end %>
                  </div>
                <% else %>
                  <p class="text-muted mb-0"><em>Willing to mentor but no specific skills indicated.</em></p>
                <% end %>

                <div class="clearfix"></div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="alert alert-info" role="alert">
        <h5 class="alert-heading">No mentors found</h5>
        <% if @query_params[:skills].present? %>
          <p class="mb-0">Try adjusting your skill filters.  When more than one skill is selected, mentor results will match all skills listed.</p>
        <% else %>
          <p class="mb-0">Select skills above to find mentors who can help you learn.</p>
        <% end %>
      </div>
    <% end %>
    <!-- Contact Mentor Modal -->
    <div class="modal fade" id="mentorContactModal" tabindex="-1" aria-labelledby="mentorContactModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="mentorContactModalLabel">Contact Mentor</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form data-mentor-contact-target="form" data-action="submit->mentor-contact#submitForm">
              <div class="mb-3">
                <label for="mentorContactMessage" class="form-label">
                  <strong>Your Message</strong>
                </label>
                <textarea
                  class="form-control"
                  id="mentorContactMessage"
                  name="message"
                  rows="8"
                  data-mentor-contact-target="message"
                  placeholder="Write your message here..."
                  required></textarea>
                <div class="form-text">
                  The mentor will receive your message and can reply directly to your email address.
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" data-mentor-contact-target="submitButton">
                  <i class="bi bi-send me-2"></i>Send Message
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
